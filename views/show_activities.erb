<!DOCTYPE html>
<html>
    <head>
        <meta charset='UTF-8' />
        <title>Activities</title>
    </head>
    <body>
        <% @account.all do |i| %>
        
        <a href="/home/">Home</a>
        <a href="/accounts/<%= i.pk %>">Account</a>
        <a href="/dashboard/<%= i.pk %>">Dashboard</a>
        <a href="/activities/<%= i.pk %>">Activities</a>
        <a href="/books/<%= i.pk %>">Books</a>
        <a href="/subjects/<%= i.pk %>">Subjects</a>
        
        <h1>Activities</h1>
        
        <a href="/activities/new/<%= i.pk %>">Add New Activity</a><br>
        
<!------Setup to organize activities by year---------------------------------->
        <!--Create empty array for years-->    
        <% year_array = [] %>
        <!--Iterate through all activities and assign the year to a variable-->
        <% @activities.each do |a| %>
            <% year = a.activity_date.year %>
            <!--Push each value into the array-->
            <% year_array.push(year) %>
        <% end %>
        <!--Remove duplicate elements in the array, then iterate through each unique value-->
        <% year_array.uniq.each { |year| %>
        
        <h3><strong><%= year %></strong></h3>
        <ol>
            <% @activities.where(Sequel.like(:activity_date, "#{year}%")).each do |a| %>
            <li>
                <a href="/activities/<%= a.account_id %>/<%= a.pk %>"><%= a.title %></a> 
                    <% Subject.association_join(:activities_subjects).where(:activity_id => a.pk).each do |j| %>
                        (<%= j.subject_name %>)
                    <% end %>
                    <%= a.activity_date.month %>-<%= a.activity_date.day %>
            </li>
            <% end %><!--End activity loop-->
        </ol>
  
        <% } %><!--End year iteration-->

        <% end %><!--End account data access-->  
    
    </body>
</html>