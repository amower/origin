<!DOCTYPE html>
<html>
    <head>
        <meta charset='UTF-8' />
        <title>Books</title>
    </head>
    <body>
        <% @account.all do |i| %>
        
        <a href="/home/">Home</a>
        <a href="/accounts/<%= i.pk %>">Account</a>
        <a href="/dashboard/<%= i.pk %>">Dashboard</a>
        <a href="/activities/<%= i.pk %>">Activities</a>
        <a href="/books/<%= i.pk %>">Books</a>
        <a href="/subjects/<%= i.pk %>">Subjects</a>
        
        <h1>Books</h1>
        
        <a href="/books/new/<%= i.pk %>">Add New Book</a><br>
        
<!------Setup to organize books by year---------------------------------->
        <!--Create empty array for years-->    
        <% year_array = [] %>
        <!--Iterate through all activities and assign the year to a variable-->
        <% @books.each do |b| %>
            <% year = b.finish_date.year %>
            <!--Push each value into the array-->
            <% year_array.push(year) %>
        <% end %>
        <!--Remove duplicate elements in the array, then iterate through each unique value-->
        <% year_array.uniq.each { |year| %>
        
        <h3><strong><%= year %></strong></h3>
        <ol>
            <% @books.where(Sequel.like(:finish_date, "#{year}%")).each do |b| %>
            <li>
                <a href="/books/<%= b.account_id %>/<%= b.pk %>"><%= b.title %></a>, by <a href="/books/author/<%= b.account_id %>/<%= b.author %>"><%= b.author %></a>. Finished on <%= b.finish_date.month %>/<%= b.finish_date.day %>. Rated <%= b.rating %> stars.  
                    <% if(b.fiction) %>
                        <%= "Fiction" %>
                    <% else %>
                        <%= "Nonfiction" %>
                    <% end %>
            </li>
            <% end %><!--End book loop-->
        </ol>
  
        <% } %><!--End year iteration-->
        
        <% end %><!--End account data access-->
        
    </body>
</html>