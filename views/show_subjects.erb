<!DOCTYPE html>
<html>
    <head>
        <meta charset='UTF-8' />
        <title>Manage Subjects</title>
    </head>
    <body>
        <% @account.all do |row| %>
        
        <a href="/home/">Home</a>
        <a href="/accounts/<%= row[:account_id] %>">Account</a>
        <a href="/dashboard/<%= row[:account_id] %>">Dashboard</a>
        <a href="/activities/<%= row[:account_id] %>">Activities</a>
        <a href="/books/<%= row[:account_id] %>">Books</a>
        <a href="/subjects/<%= row[:account_id] %>">Subjects</a>
        
        
        
        <h2>My Portfolio Subjects:</h2>
        
        <ol><% @subjects.each do |row| %>
            <li>
                <%= row[:subject_name] %> (<a href="/subjects/update/<%= row[:account_id] %>/<%= row[:subject_id] %>">Edit</a>) (<a href="/subjects/change/<%= row[:subject_id] %>">Delete</a>)
            </li>
            <% end %>
        </ol>
        
        <a href="/subjects/new/<%= row[:account_id] %>">Add New Subject</a><br>
        <% end %>
        
        <h1>All Activities Organized by Subject</h1>
        
        <!--Link to account_id below is not working-->
        <ul>
            <% @subjects.each do |row| %>
            <li><a href="/subjects/<%= row[:account_id] %>/<%= row[:subject_id] %>"><%= row[:subject_name] %> (<%= @activities.where(Sequel[:activities_subjects][:subject_id] => row[:subject_id]).count %>)</a>
                <ol><% @activities.where(Sequel[:activities_subjects][:subject_id] => row[:subject_id]).each do |row| %>
                    <li><%= row[:title] %>, <%= row[:activity_date] %></li>
                    <% end %>
                </ol>
            </li>
            <% end %>
        </ul>
        
    </body>
</html>